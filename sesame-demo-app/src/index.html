<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Sesame Research Demo</title>
    <style>
        html, body {
            margin: 0;
            padding: 0;
            width: 691px;
            height: 448px;
            overflow: hidden;
            background-color: #e8ede4;
        }
        #error-container {
            display: none;
            position: absolute;
            top: 0;
            left: 0;
            width: 691px;
            height: 448px;
            background-color: white;
            z-index: 1000;
            text-align: center;
            padding-top: 50px;
        }
        #webview-container {
            width: 691px;
            height: 448px;
            position: relative;
        }
        webview {
            width: 691px;
            height: 448px;
            border: none;
        }
    </style>
</head>
<body>
    <div id="error-container">
        <h1>Page Load Error</h1>
        <p>Unable to load the Sesame Research demo page.</p>
        <p>Please check your internet connection or contact support.</p>
    </div>
    <div id="webview-container">
        <webview 
            id="mainWebview"
            src="https://www.sesame.com/research/crossing_the_uncanny_valley_of_voice#demo" 
            allowfullscreen 
            webpreferences="nodeIntegration=no, contextIsolation=yes"
            partition="persist:sesame"
        ></webview>
    </div>

    <script>
        document.addEventListener('DOMContentLoaded', () => {
            const webview = document.getElementById('mainWebview');
            const errorContainer = document.getElementById('error-container');

            // Logging function
            function logMessage(message) {
                console.log(message);
                window.electronAPI.sendMessage('log', message);
            }

            // Error handling
            webview.addEventListener('did-fail-load', (event) => {
                logMessage('Webview failed to load');
                logMessage(JSON.stringify(event));
                
                // Show error container
                errorContainer.style.display = 'block';
                webview.style.display = 'none';
            });

            webview.addEventListener('dom-ready', () => {
                logMessage('Webview DOM is ready');
                
                try {
                    // Inject CSS to focus on demo section while preserving functionality
                    webview.insertCSS(`
                        * {
                            box-sizing: border-box !important;
                        }
                        html, body {
                            width: 691px !important;
                            height: 448px !important;
                            max-width: 691px !important;
                            max-height: 448px !important;
                            overflow: hidden !important;
                            margin: 0 !important;
                            padding: 0 !important;
                            background: #e8ede4 !important;
                        }
                        #app {
                            width: 691px !important;
                            height: 448px !important;
                            overflow: hidden !important;
                        }
                    `);

                    // Execute JavaScript to prepare the demo section
                    webview.executeJavaScript(`
                        // Find the demo container
                        const demoContainer = document.querySelector('[data-sentry-component="Visualizer"]');
                        
                        if (demoContainer) {
                            // Ensure the demo section fills the entire view
                            demoContainer.style.width = '691px';
                            demoContainer.style.height = '448px';
                            demoContainer.style.margin = '0';
                            demoContainer.style.padding = '0';
                            demoContainer.style.overflow = 'hidden';
                            
                            // Preserve original click interactions
                            const mayaButton = demoContainer.querySelector('[aria-label="Maya"]');
                            const milesButton = demoContainer.querySelector('[aria-label="Miles"]');
                            
                            if (mayaButton) {
                                mayaButton.style.cursor = 'pointer';
                                mayaButton.addEventListener('click', (e) => {
                                    // Ensure the original click handler is preserved
                                    const originalHandler = Object.values(mayaButton).find(prop => 
                                        prop && prop.onClick
                                    )?.onClick;
                                    
                                    if (originalHandler) {
                                        originalHandler(e);
                                    }
                                });
                            }
                            
                            if (milesButton) {
                                milesButton.style.cursor = 'pointer';
                                milesButton.addEventListener('click', (e) => {
                                    // Ensure the original click handler is preserved
                                    const originalHandler = Object.values(milesButton).find(prop => 
                                        prop && prop.onClick
                                    )?.onClick;
                                    
                                    if (originalHandler) {
                                        originalHandler(e);
                                    }
                                });
                            }
                            
                            console.log('Demo section prepared successfully');
                        } else {
                            console.error('Could not find demo section');
                        }
                    `);
                } catch (error) {
                    logMessage('Error in dom-ready handler: ' + error.message);
                }
            });

            // Prevent navigation away from demo
            webview.addEventListener('will-navigate', (event) => {
                const url = new URL(event.url);
                if (!url.hash.includes('demo')) {
                    event.preventDefault();
                    logMessage('Navigation prevented: ' + event.url);
                }
            });

            // Enable devtools for debugging
            webview.addEventListener('dom-ready', () => {
                // Uncomment for debugging
                // webview.openDevTools();
            });
        });
    </script>
</body>
</html>